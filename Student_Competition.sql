USE cafy21573;

DROP TABLE STUDENT_COMPETITION;
DROP TABLE COMPETITION;
DROP TABLE STUDENT2;

CREATE TABLE STUDENT2(SREG_NO INT PRIMARY KEY, SNAME VARCHAR(30), CLASS VARCHAR(10));
CREATE TABLE COMPETITION(C_NO INT PRIMARY KEY, CNAME VARCHAR(20), TYPE VARCHAR(15));
CREATE TABLE STUDENT_COMPETITION(SREG_NO INT, FOREIGN KEY(SREG_NO) REFERENCES STUDENT2(SREG_NO), C_NO INT, FOREIGN KEY(C_NO) REFERENCES COMPETITION(C_NO), SRANK INT, YEAR INT);

DESC STUDENT2;
DESC COMPETITION;
DESC STUDENT_COMPETITION;

INSERT INTO STUDENT2(SREG_NO, SNAME, CLASS) VALUES(101, 'VISHAL', 'FYMCA');
INSERT INTO STUDENT2(SREG_NO, SNAME, CLASS) VALUES(102, 'YASH', 'SYMCA');
INSERT INTO STUDENT2(SREG_NO, SNAME, CLASS) VALUES(103, 'SHUBHAM', 'TYBCA');
INSERT INTO STUDENT2(SREG_NO, SNAME, CLASS) VALUES(104, 'HARSHAL', 'TYBSC');
INSERT INTO STUDENT2(SREG_NO, SNAME, CLASS) VALUES(105, 'NIRMAL', 'SYMCA');

INSERT INTO COMPETITION(C_NO, CNAME, TYPE) VALUES(601, 'BLIND CODING', 'ACADEMIC'); 
INSERT INTO COMPETITION(C_NO, CNAME, TYPE) VALUES(602, 'PROJECT', 'ACADEMIC');
INSERT INTO COMPETITION(C_NO, CNAME, TYPE) VALUES(603, 'PRESENTATION', 'ACADEMIC');
INSERT INTO COMPETITION(C_NO, CNAME, TYPE) VALUES(604, 'BASKETBALL', 'SPORTS');
INSERT INTO COMPETITION(C_NO, CNAME, TYPE) VALUES(605, 'CHESS', 'SPORTS');

INSERT INTO STUDENT_COMPETITION(SREG_NO, C_NO, SRANK, YEAR) VALUES(101, 604, 1, 2001); 
INSERT INTO STUDENT_COMPETITION(SREG_NO, C_NO, SRANK, YEAR) VALUES(102, 601, 2, 2001);
INSERT INTO STUDENT_COMPETITION(SREG_NO, C_NO, SRANK, YEAR) VALUES(103, 602, 1, 2001);
INSERT INTO STUDENT_COMPETITION(SREG_NO, C_NO, SRANK, YEAR) VALUES(104, 603, 1, 2001);
INSERT INTO STUDENT_COMPETITION(SREG_NO, C_NO, SRANK, YEAR) VALUES(105, 605, 2, 2001);
INSERT INTO STUDENT_COMPETITION(SREG_NO, C_NO, SRANK, YEAR) VALUES(101, 603, 2, 2001);
INSERT INTO STUDENT_COMPETITION(SREG_NO, C_NO, SRANK, YEAR) VALUES(103, 601, 1, 2001);
INSERT INTO STUDENT_COMPETITION(SREG_NO, C_NO, SRANK, YEAR) VALUES(105, 604, 2, 2001);

SELECT * FROM STUDENT2;
SELECT * FROM COMPETITION;
SELECT * FROM STUDENT_COMPETITION;

/*VIEWS*/
/*A*/
DROP VIEW V9;
CREATE VIEW V9 AS SELECT C.CNAME, C.TYPE FROM COMPETITION C ORDER BY C.TYPE;

/*B*/
DROP VIEW V10;
CREATE VIEW V10 AS SELECT SNAME, CLASS, CNAME, SRANK, YEAR FROM STUDENT2 S, COMPETITION C, STUDENT_COMPETITION SC
WHERE S.SREG_NO = SC.SREG_NO AND C.C_NO = SC.C_NO ORDER BY SNAME;

SELECT * FROM V9; 
SELECT * FROM V10;

/*FUNCTIONS*/
/*A*/
DROP FUNCTION F8;
DELIMITER $
CREATE FUNCTION F8(CTYPE VARCHAR(20))
RETURNS INTEGER
DETERMINISTIC
BEGIN
	DECLARE TOTALNOCOMP INTEGER;
    SELECT COUNT(C_NO) INTO TOTALNOCOMP FROM COMPETITION 
    WHERE TYPE = CTYPE;
    RETURN TOTALNOCOMP;
END $
DELIMITER ;
SELECT F8("ACADEMIC");

/*B*/
DROP FUNCTION F9;
DELIMITER $
CREATE FUNCTION F9(NAME VARCHAR(20))
RETURNS INTEGER
DETERMINISTIC
BEGIN
	DECLARE TOTALNOPRIZE INTEGER;
    SELECT COUNT(S.SREG_NO) INTO TOTALNOPRIZE FROM STUDENT2 S, STUDENT_COMPETITION SC
    WHERE S.SREG_NO = SC.SREG_NO AND SNAME = NAME AND YEAR = 2001;
    RETURN TOTALNOPRIZE;
END $
DELIMITER ;
SELECT F9("VISHAL");