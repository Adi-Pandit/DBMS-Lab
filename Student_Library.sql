USE cafy21573;

DROP TABLE ISS_REC;
DROP TABLE BOOK;
DROP TABLE MEMBERSHIP;
DROP TABLE STUDENT;

CREATE TABLE STUDENT(STUD_NO VARCHAR(10) PRIMARY KEY, STUD_NAME VARCHAR(10));
CREATE TABLE MEMBERSHIP(MEM_NO VARCHAR(10) PRIMARY KEY, STUD_NO VARCHAR(10), FOREIGN KEY(STUD_NO) REFERENCES STUDENT(STUD_NO));
CREATE TABLE BOOK(BOOK_NO VARCHAR(10) PRIMARY KEY, BOOK_NAME VARCHAR(30), AUTHOR VARCHAR(20));
CREATE TABLE ISS_REC(ISS_NO VARCHAR(10) PRIMARY KEY, ISS_DATE DATE, MEM_NO VARCHAR(10), FOREIGN KEY(MEM_NO) REFERENCES MEMBERSHIP(MEM_NO), BOOK_NO VARCHAR(10), FOREIGN KEY(BOOK_NO) REFERENCES BOOK(BOOK_NO));

DESC STUDENT;
DESC MEMBERSHIP;
DESC BOOK;
DESC ISS_REC;

INSERT INTO STUDENT(STUD_NO,STUD_NAME) VALUES('1','ABHINAV');
INSERT INTO STUDENT(STUD_NO,STUD_NAME) VALUES('2','ADITYA');
INSERT INTO STUDENT(STUD_NO,STUD_NAME) VALUES('3','ADITYA');
INSERT INTO STUDENT(STUD_NO,STUD_NAME) VALUES('4','ANAMIKA');
INSERT INTO STUDENT(STUD_NO,STUD_NAME) VALUES('5','ARPITA');

INSERT INTO MEMBERSHIP(MEM_NO,STUD_NO) VALUES('LIB001','1');
INSERT INTO MEMBERSHIP(MEM_NO,STUD_NO) VALUES('LIB002','2');
INSERT INTO MEMBERSHIP(MEM_NO,STUD_NO) VALUES('LIB003','3');
INSERT INTO MEMBERSHIP(MEM_NO,STUD_NO) VALUES('LIB004','4');
INSERT INTO MEMBERSHIP(MEM_NO,STUD_NO) VALUES('LIB005','5');

INSERT INTO BOOK(BOOK_NO,BOOK_NAME,AUTHOR) VALUES('BOOK21345','DBMS','KORTH');
INSERT INTO BOOK(BOOK_NO,BOOK_NAME,AUTHOR) VALUES('BOOK21346','RDBMS','KORTH');
INSERT INTO BOOK(BOOK_NO,BOOK_NAME,AUTHOR) VALUES('BOOK21657','LET US C','YASHWANT KANITKAR');
INSERT INTO BOOK(BOOK_NO,BOOK_NAME,AUTHOR) VALUES('BOOK21123','CORE PYTHON','NAGESHSWARA RAO');
INSERT INTO BOOK(BOOK_NO,BOOK_NAME,AUTHOR) VALUES('BOOK21987','REAL ANALYSIS','BARTLE AND SHERBERT');
INSERT INTO BOOK(BOOK_NO,BOOK_NAME,AUTHOR) VALUES('BOOK21324','CORE JAVA','E BALAGURUSWAMY');
INSERT INTO BOOK(BOOK_NO,BOOK_NAME,AUTHOR) VALUES('BOOK21564','COMPLEX ANALYSIS','WISTON AND CHURCHILL');

INSERT INTO ISS_REC(ISS_NO,ISS_DATE,MEM_NO,BOOK_NO) VALUES('23451','2020/3/14','LIB001','BOOK21345');
INSERT INTO ISS_REC(ISS_NO,ISS_DATE,MEM_NO,BOOK_NO) VALUES('23465','2020/3/21','LIB002','BOOK21657');
INSERT INTO ISS_REC(ISS_NO,ISS_DATE,MEM_NO,BOOK_NO) VALUES('23678','2020/3/5','LIB003','BOOK21123');
INSERT INTO ISS_REC(ISS_NO,ISS_DATE,MEM_NO,BOOK_NO) VALUES('23768','2020/3/4','LIB004','BOOK21987');
INSERT INTO ISS_REC(ISS_NO,ISS_DATE,MEM_NO,BOOK_NO) VALUES('23654','2020/3/1','LIB005','BOOK21324');
INSERT INTO ISS_REC(ISS_NO,ISS_DATE,MEM_NO,BOOK_NO) VALUES('23546','2020/3/10','LIB004','BOOK21564');

SELECT * FROM STUDENT;
SELECT * FROM MEMBERSHIP;
SELECT * FROM BOOK;
SELECT * FROM ISS_REC;

SELECT BOOK_NAME FROM BOOK WHERE AUTHOR = "KORTH";

SELECT * FROM BOOK ORDER BY BOOK_NAME;

SELECT * FROM STUDENT ORDER BY STUD_NAME;

SELECT S.STUD_NO, COUNT(I.BOOK_NO) FROM BOOK B, STUDENT S, ISS_REC I, MEMBERSHIP M
WHERE S.STUD_NO = M.STUD_NO AND M.MEM_NO = I.MEM_NO AND B.BOOK_NO = I.BOOK_NO 
GROUP BY S.STUD_NO;

SELECT BOOK_NAME FROM BOOK 
WHERE BOOK_NO IN (SELECT BOOK_NO FROM ISS_REC 
WHERE MEM_NO IN (SELECT MEM_NO FROM MEMBERSHIP 
WHERE STUD_NO IN (SELECT STUD_NO FROM STUDENT 
WHERE STUD_NO = 5 )));